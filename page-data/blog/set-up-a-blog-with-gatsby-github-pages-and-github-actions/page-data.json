{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/set-up-a-blog-with-gatsby-github-pages-and-github-actions/","result":{"data":{"site":{"siteMetadata":{"title":"XKoji.dev","siteUrl":"https://www.xkoji.dev"}},"markdownRemark":{"id":"3fcebd53-ba1e-55f7-848d-81115298a152","excerpt":"This is my first post on my new blog! How exciting! Creating this blog was an interesting process for me since I decided to use Gatsby for it. While I hadâ€¦","html":"<p>This is my first post on my new blog! How exciting! Creating this blog was an interesting process for me since I decided to use Gatsby for it. While I had created a <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-altair-graphql/\">gatsby plugin</a> before, I hadnâ€™t actually built anything with gatsby. Starting this new blog was an opportunity to change that.</p>\n<p>For my setup, I decided to start off with hosting the blog on <a href=\"https://pages.github.com/\">GitHub pages</a>. <a href=\"https://github.com/features/actions\">GitHub actions</a> made sense as the perfect tool for continuous deployment of the site, which also happened to be the first time I am using GitHub actions.</p>\n<p>After a couple of hours spent figuring out how to properly setup everything, I finally had the blog live and running at <a href=\"https://xkojimedia.github.io/\">xkojimedia.github.io</a> with a minimal template.</p>\n<p>Here I would go over how I was able to setup everything.</p>\n<h3>What is Gatsby and why should I be using it?</h3>\n<p>Quoting from their site,</p>\n<blockquote>\n<p>Gatsby is a blazing fast modern site generator for React.</p>\n</blockquote>\n<p>That covers the basic cases where you would want to use Gatsby. However, given the rich plugin ecosystem that is available to, and created by the Gatsby community, you can use Gatsby for a whole lot more use cases, like a blog, ecommerce platformm, etc. It is also built with the best practices in mind for the best user experience, including optional offline support for PWAs.</p>\n<p>The development experience while working with Gatsby is also great. There are several starter repos to help get you started quickly using Gatsby. The one I would be using is <a href=\"https://www.gatsbyjs.org/starters/gatsbyjs/gatsby-starter-blog/\">gatsby-starter-blog</a>. I chose it since it is one of the most popular starters for creating blogs with Gatsby.</p>\n<h3>Setting things up</h3>\n<p>First, make sure that you have the latest version of node installed (Gatsby aims to support any node version that hasnâ€™t reached itâ€™s <em>End of Life</em> status, but it is always safer to just use the latest version and not have to check if your node version is too old). </p>\n<p>Run <code class=\"language-text\">node -v</code> in a terminal to see which version of Node.js you have.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">node -v\nv12.16.2</code></pre></div>\n<p>Next, install the gatsby CLI package globally on your machine, to enable you run gatsby commands.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gatsby-cli</code></pre></div>\n<p>Once gatsby-cli is installed, create a new gatsby project using the <a href=\"https://github.com/gatsbyjs/gatsby-starter-blog\">gatsby-starter-blog</a> starter, and call it whatever you would like. For the sake of this tutorial, we would call it <strong>my-blog</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby new my-blog https://github.com/gatsbyjs/gatsby-starter-blog</code></pre></div>\n<p>This would create a <strong>my-blog</strong> directory with the contents of the gatsby-starter-blog repo and install the dependencies.</p>\n<blockquote>\n<p>Note: It removes the .git directory from the new project, so the project isnâ€™t a repository pointing to the starter. So no need for you to look for that.</p>\n</blockquote>\n<p>Once the process is completed, you can <code class=\"language-text\">cd</code> into the new directory and run <code class=\"language-text\">npm run develop</code> (<code class=\"language-text\">yarn develop</code>) or <code class=\"language-text\">gatsby develop</code>. I would recommend running <code class=\"language-text\">npm run develop</code> (or <code class=\"language-text\">yarn develop</code> using yarn) since this would use the local version of gatsby installed in the project, as opposed to using the globally installed gatsby command. This helps avoid issues with different versions of the gatsby binary used in different projects, so each project uses the gatsby version specific to the project.</p>\n<blockquote>\n<p>Note: The starter comes with both <code class=\"language-text\">package-lock.json</code> and <code class=\"language-text\">yarn.lock</code> files. I assume this is to give users the option to choose between yarn and npm. I would recommend choosing one of the two package managers early on, and delete the lock file for the other package manager, to avoid confusion later in the future.</p>\n</blockquote>\n<p>Running the develop script would compile the assets for the site, and watch the files for changes (Gatsby uses webpack underneath for bundling). At this point, open <a href=\"http://localhost:8000\">http://localhost:8000</a> to see the blog.</p>\n<p>Easy! Now you have a minimal blog setup that actually works. You can make changes to any of the .md files in <code class=\"language-text\">content/blog</code> directory, and you should see the changes reflected on the site. For further details on how to customize the blog, that is beyond the scope of this post. You can go through the README file that comes with the project, and also checkout the Gatsby docs.</p>\n<h3>Setting up GitHub Pages</h3>\n<p>GitHub allows you setup <a href=\"https://help.github.com/en/github/working-with-github-pages/creating-a-github-pages-site\">user, organization and project sites</a>. For project sites, you can choose to serve the files from the <code class=\"language-text\">/docs</code> folder of the repo of the project, the <code class=\"language-text\">master</code> branch or the <code class=\"language-text\">gh-pages</code> branch of your project repo. For user/organization sites, you only have the options of serving the public files from the <code class=\"language-text\">master</code> or <code class=\"language-text\">gh-pages</code> branch of a repo. You would need to create a repo called <code class=\"language-text\">&lt;user&gt;.github.io</code> I chose to host the blog as an organization site with the files served from the <code class=\"language-text\">master</code> branch of the repo. For the gatsby project, the files being served are stored in the <code class=\"language-text\">public</code> directory after building the project. That is the part we would need in the github pages repo. We would need to have a repo for the project, and copy over the <code class=\"language-text\">public</code> content into the github pages repo.</p>\n<p>Now initialize the git repo in the project if you havenâ€™t already done that already (using <code class=\"language-text\">git init</code>) and commit that into GitHub. Also create the user or organization site. Letâ€™s assume the username is <strong>blogger</strong>. You would create a repo called <code class=\"language-text\">blogger.github.io</code>. Build the project using <code class=\"language-text\">yarn build</code> and copy the contents of the <code class=\"language-text\">/public</code> directory into the <code class=\"language-text\">blogger.github.io</code> repo and commit it. If all goes well, you should be able to see the site live at <a href=\"https://blogger.github.io\">https://blogger.github.io</a> URL. Thatâ€™s a milestone! ðŸŽ‰</p>\n<p>Next thing we need to do is setup automatically copying the public assets into the <code class=\"language-text\">blogger.github.io</code> repo.</p>\n<h3>Continuous delivery using GitHub Actions</h3>\n<p>GitHub actions is a new workflow automation tool provided by GitHub. It provides similar functionality available in CI/CD tools like Travis CI, appveyor, circle CI, etc. I would be using it since it is a free automation tool and integrates well with GitHub in a seamless and easy way.</p>\n<p>We would create a GitHub action workflow that:</p>\n<ul>\n<li>checks out the repository in a workflow runner</li>\n<li>installs the node modules</li>\n<li>builds the package</li>\n<li>copies the public assets into the <code class=\"language-text\">blogger.github.io</code> repo</li>\n</ul>\n<p>Weâ€™d create the workflow in <code class=\"language-text\">.github/workflows/pages.yml</code> with the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Pages\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> master <span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use Node.js\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'12.x'</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        git config --global user.email \"&lt;your-email-address>\"\n        git config --global user.name \"&lt;your-name>\"</span>\n\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn deploy\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">PA_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.PA_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">CI</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>There are a number of things going on here, so letâ€™s break it down.</p>\n<p>First we name the workflow as <code class=\"language-text\">GitHub Pages</code>.\nWe specify that the workflow should be run whenever any commit is pushed to the <code class=\"language-text\">master</code> branch.\nA <code class=\"language-text\">build</code> job is specified to run on the latest ubuntu VM with the following steps:</p>\n<ul>\n<li>uses the <a href=\"https://github.com/marketplace/actions/checkout\">Checkout</a> GitHub action to checkout the repo in the workflow</li>\n<li>uses the <a href=\"https://github.com/marketplace/actions/setup-node-js-environment\">Setup Node.js environment</a> GitHub action to get the workflow environment setup for Node.js using the latest node 12 version.</li>\n<li>run <code class=\"language-text\">yarn</code> to install the node modules</li>\n<li>configure git to be able to push to the <code class=\"language-text\">blogger.github.io</code> repo</li>\n<li>run <code class=\"language-text\">yarn deploy</code> script (which we would define later) which will build and deploy the project to the <code class=\"language-text\">blogger.github.io</code> repo. Specify <code class=\"language-text\">PA_TOKEN</code> environment variable that would be used by the <code class=\"language-text\">deploy</code> script to authenticate pushing to the repo. The <code class=\"language-text\">PA_TOKEN</code> is your <a href=\"https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line\">personal access token</a> with permission to write to the <code class=\"language-text\">blogger.github.io</code> repo. To create a personal access token, go to your <a href=\"https://github.com/settings/tokens/new\">tokens settings</a> page and select the <code class=\"language-text\">repo</code> scope. After creating the personal access token, set the token as the <code class=\"language-text\">PA_TOKEN</code> secret in the project repo by going to the repo <code class=\"language-text\">Settings -&gt; Secrets -&gt; Add a new secret</code>. Now you can access the secret in the workflow using <code class=\"language-text\">${{ secrets.PA_TOKEN }}</code>. More information about secrets in workflows can be found <a href=\"https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets\">here</a>.</li>\n</ul>\n<p>For the deploy script, we would use the <a href=\"https://www.npmjs.com/package/gh-pages\">gh-pages</a> npm package to push the github pages assets into the <code class=\"language-text\">blogger.github.io</code> repo using <code class=\"language-text\">gh-pages -d public -b master -r &quot;https://&lt;your-username&gt;:$PA_TOKEN@github.com/blogger/blogger.github.io.git&quot;</code>. This command specifies the <code class=\"language-text\">public</code> directory as the source of the github pages, specifies the <code class=\"language-text\">master</code> branch, and specifies the remote repo as <code class=\"language-text\">https://&lt;your-username&gt;:$PA_TOKEN@github.com/blogger/blogger.github.io.git</code>. The URL specifies the GitHub HTTP URL along with the username and password used for the authentication of the git operations. You specify your username and the <code class=\"language-text\">PA_TOKEN</code> variable replaces your password. <em>You should never use your actual password in automation scripts. Always make use of access tokens that have the scope you need for that script.</em></p>\n<p>Your deploy script in the <code class=\"language-text\">package.json</code> file would look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    ...\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build &amp;&amp; gh-pages -d public -b master -r \\\"https://blogger:$PA_TOKEN@github.com/blogger/blogger.github.io.git\\\"\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Thatâ€™s it! Now you push your changes to GitHub, your GitHub action workflow should pick up your changes and run the workflow. You can find the running GitHub actions in the Actions menu in the project repo.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaElEQVQI1z2O2QoDMQwD9/8/tk3j+MrRqZeFPgijQTK65tpob0h7IRaP9JbzaU57OyLlhzKKdVHUiqk9dxgeWZpETq5zvmQ44Yp7FEyiAqMKQ5LeAtXE3MkqWD3JOf/Z26+9OeewatwPDgqbeOmci30AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github actions menu\"\n        title=\"github actions menu\"\n        src=\"/static/af52c53ca5744fbfa9cb4808875308fd/c1b63/github-actions-menu.png\"\n        srcset=\"/static/af52c53ca5744fbfa9cb4808875308fd/5a46d/github-actions-menu.png 300w,\n/static/af52c53ca5744fbfa9cb4808875308fd/0a47e/github-actions-menu.png 600w,\n/static/af52c53ca5744fbfa9cb4808875308fd/c1b63/github-actions-menu.png 1200w,\n/static/af52c53ca5744fbfa9cb4808875308fd/d61c2/github-actions-menu.png 1800w,\n/static/af52c53ca5744fbfa9cb4808875308fd/7da7d/github-actions-menu.png 2120w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Once the action workflow is completed, you should see the new public assets in the <code class=\"language-text\">blogger.github.io</code> repo.</p>\n<h3>Conclusion</h3>\n<p>For a simple blog, Gatsby works well with GitHub Pages for hosting and GitHub actions for automating the workflow. For more dynamic content and sites, you would need some other hosting platform as GitHub Pages handles hosting static pages. However, you can still make use of Gatsby and GitHub actions for more dynamic sites.</p>","frontmatter":{"title":"Set up a blog with Gatsby, GitHub pages and GitHub actions","date":"April 27, 2020","description":"","image":{"publicURL":"/static/c2b497b8b1128ac9a208938a54d4ff1a/gatsby-github.png"}}}},"pageContext":{"slug":"/blog/set-up-a-blog-with-gatsby-github-pages-and-github-actions/","previous":null,"next":{"fields":{"slug":"/blog/automate-scaffolding-processes-with-plop/"},"frontmatter":{"title":"Automate scaffolding processes with Plop"}}}}}