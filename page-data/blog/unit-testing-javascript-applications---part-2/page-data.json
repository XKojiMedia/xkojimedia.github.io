{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/unit-testing-javascript-applications---part-2/","result":{"data":{"site":{"siteMetadata":{"title":"XKoji.dev","siteUrl":"https://www.xkoji.dev"}},"markdownRemark":{"id":"3e79a06c-b2c4-5379-a0bb-1959951a7f4d","excerpt":"In the previous post, we began talking about what unit testing is about, why we should consider writing unit tests, and how we should approach it. In this post…","html":"<p>In the <a href=\"https://www.xkoji.dev/blog/unit-testing-javascript-applications-part-1/\" target=\"_blank\" rel=\"nofollow\">previous post</a>, we began talking about what unit testing is about, why we should consider writing unit tests, and how we should approach it. In this post, we will continue with some more practical things to consider and also writing some unit tests for a Vue.js application.</p>\n<h2 id=\"the-application\" style=\"position:relative;\">The Application</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJklEQVQoz22SW2sTQRiG9y95ulAKgpaq4IU3/gl/gbVFMEJFiuhNlWAiWm8SYtog29QkjZtDDyZjE2vWNidpqGiNSUlru+fD68ykWVPoBw+z8L07M8+3K9y67MPt0SncHPFh7PwExi5MUiYweu4erpy563H9og83Rh7h2qWHuHp2nDPcHyAk0wSRyEcsRlNYzlawnJFBVusga3UUV2t91hoI+d8gcH8SoWczyEsyclIFhRXWr59AKO18x0Iui005jyPtL0XFaVUW/egU51GKPMFerwvV1E7NCaS4glxqEU0iQbdsOLYL27Y5lsVWB5quoy1LUCpL+Lkex6GiwXHg9RnsmSHUqwRSNgJCEvzFQ0WFYVjQKYZp8ZBpOdj/kcKf6lv0tkUoqgZF03hfN0wvxzckH2YRC9zBy/A4dtsdtDt7UOgNWJCdzIqt7co0tktB/P76lOZ20e0dQNX0fs5x/isXPhWRef0CYfExNNpk5boux6HQB6iGjZh/CnLwARKhaZh0HMM1yDKE5hZBMTYHeSPJldmpJte0+GrRl9lst9bLqMTj9A8gPHNER8PQdINnPOWCOAN5IYBW+R1+Hasoal/FOVZxHReFL3kk3j9Ho17rj6bbRW//ADq9xImv/I1EsZN+hdqGSNVMZsg38mAqdMNq9TNC6Tk0Wi1vtoNifU95s1bCfDhIT2zy6/eVLa4xUDZMG/FMBrNJCdHkEjSaUanF8Ncd8A+xFgcvsIAwEwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"app screenshot\"\n        title=\"app screenshot\"\n        src=\"/static/74dd8acefece9fe3b016646427da5df2/c1b63/ricks-place-app.png\"\n        srcset=\"/static/74dd8acefece9fe3b016646427da5df2/5a46d/ricks-place-app.png 300w,\n/static/74dd8acefece9fe3b016646427da5df2/0a47e/ricks-place-app.png 600w,\n/static/74dd8acefece9fe3b016646427da5df2/c1b63/ricks-place-app.png 1200w,\n/static/74dd8acefece9fe3b016646427da5df2/d61c2/ricks-place-app.png 1800w,\n/static/74dd8acefece9fe3b016646427da5df2/97a96/ricks-place-app.png 2400w,\n/static/74dd8acefece9fe3b016646427da5df2/93ba6/ricks-place-app.png 2874w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACXklEQVQoz22Ty2sTURSH8xe5cuVKaEUsii5EVFQqsVpM0po07xd5vyYzeTZNTGLatFFErFZwoYvShRQtFjeCFQoRV1YpNLSpSTPJz3PvpCOCA4dMyLnfOd85N5oHLh8mDCaYLTMIJ1IUGcTFHNL5EhaePEf96QtU55cgRQIoZyUIfjdCMRERgfKkPJLpAsSMEuxdY7E7MW00w22z8QQhVUCUksvzDXzeWMPm6ks0m03stfYhD4CjnoxipY5oMku5s0hIf4Od17hcDuj0WuhMOqosIRhL8erFcg3N9dfYflPHz50d/Nrdw+Hhb8iyjNnSI/gjIhIEjIt5DlKBRoMOE7cu4Kr2IsEkrsygD6uLaG2v4WDrFdrtNvrUHXt6vR4Ba/BHRcSSOR4MzHRZxxqz3Yfp23eh1d8k1Sz9MMc/K6Tc6bYIRLB+H4PBQAWWqBgDJTNzEIYgRZ86dDptmNFPweW0IhRXOoxQVGgRzS8H+PG9S5gBqTIozfCox5W9wQSCUYnnKjNU1DWm++OwTo7DbZkk1STNL8uVy7UlbH3axbevLcL1eWcyddrpdLlygJTZbRCGuqqy3WWG13gPDqeZNpdTlGmD1YXHvLP/PZVag8NEpjzUVZUdHg+uXLtB7YeULVNlpp0tVPBufQPvP2xSfERjeQUrb1ex+GyZH/aFBV74eLtcmTausdmMODt6Gm6XieaRRoR02VJYcoCuRoi+s1mdPDOGc5cu48TIGDw0vxifXV7VVZW9Tgum7lyH1WSg2aXVK6D8A+YgZouQ6H2EYKdGz/PwhqV/IMdzZGf/AEMsbomoUVKvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"character details\"\n        title=\"character details\"\n        src=\"/static/987e828c7fa19de1342a7f7a16d7776c/c1b63/ricks-place-character-details.png\"\n        srcset=\"/static/987e828c7fa19de1342a7f7a16d7776c/5a46d/ricks-place-character-details.png 300w,\n/static/987e828c7fa19de1342a7f7a16d7776c/0a47e/ricks-place-character-details.png 600w,\n/static/987e828c7fa19de1342a7f7a16d7776c/c1b63/ricks-place-character-details.png 1200w,\n/static/987e828c7fa19de1342a7f7a16d7776c/d61c2/ricks-place-character-details.png 1800w,\n/static/987e828c7fa19de1342a7f7a16d7776c/97a96/ricks-place-character-details.png 2400w,\n/static/987e828c7fa19de1342a7f7a16d7776c/d9ed5/ricks-place-character-details.png 2880w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The application we would be testing is a very simple one. It fetches and displays a list of characters from the TV series <em>“Rick and Morty”</em>. It also displays the character details in a modal dialog. You can add a note to any character in the app, and the notes are persisted to a remote storage and available to anyone using the app.</p>\n<p><em>You can checkout the full application with the tests in this repo: <a href=\"https://github.com/imolorhe/rick-morty\" target=\"_blank\" rel=\"nofollow\">https://github.com/imolorhe/rick-morty</a></em></p>\n<h3 id=\"what-is-the-application-built-with\" style=\"position:relative;\">What is the application built with?</h3>\n<p>The application is built with the <a href=\"https://vuejs.org/\" target=\"_blank\" rel=\"nofollow\">Vue.js</a> as the JS framework consisting of a few views and components, bootstrapped using the <a href=\"https://cli.vuejs.org/\" target=\"_blank\" rel=\"nofollow\">Vue CLI</a> tool. The application is written in <a href=\"https://www.typescriptlang.org/\" target=\"_blank\" rel=\"nofollow\">TypeScript</a>, compiled to JavaScript. The client state of the application is managed using <a href=\"https://vuex.vuejs.org/\" target=\"_blank\" rel=\"nofollow\">Vuex</a>, the de-facto state management library for Vue applications, routing managed by <a href=\"https://router.vuejs.org/\" target=\"_blank\" rel=\"nofollow\">Vue router</a>, styling based on <a href=\"https://tailwindcss.com/\" target=\"_blank\" rel=\"nofollow\">Tailwind CSS</a>, and <a href=\"https://github.com/axios/axios\" target=\"_blank\" rel=\"nofollow\">axios</a> for sending API requests. Nothing too fancy.</p>\n<p>The application makes use of the <a href=\"https://rickandmortyapi.com/\" target=\"_blank\" rel=\"nofollow\">Rick and Morty API</a> <em>(btw consider <a href=\"https://rickandmortyapi.com/help-us\" target=\"_blank\" rel=\"nofollow\">supporting</a> them)</em>. Although the rickandmortyapi also comes with a GraphQL endpoint, we would be using the REST API, to keep things simple (REST is still the most common API format). If you would like to use the GraphQL API, you can make use of the <a href=\"https://apollo.vuejs.org/\" target=\"_blank\" rel=\"nofollow\">Vue Apollo</a> package to integrate GraphQL within your application.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuElEQVQoz4WTS3ajMBBFWU34CSEkkIT42IBjx04yyDDD3kbvoFf9usTHON05J4M6AlR1/epVOWi6G+rmAluf0R1e4doXen+BdWdoe4ahaCnHv7uO8toz6vYCVY4o9YTKnND0V4zXN4y3VwRpViPJDGQ5QFVLkih6pMyhqHqI8gCed+BiDbrL6GT+W9EhLw4QusPn73f8+vOBgHGHOPXQlpL6+UxYjadQozlNGC43FHKYC+dieQTjDWKKKLUI4wpRrOczTAyChBkodSSFI2ICxZQU0UWY6FlZ5z6ovedZmYctwJZyzQIhWJRsUa1AUlCII54iRb9WzRc+Wcge1l5nK4TcFWa576ZFyu1sVxhVdyh5aJGLHixrFvnrxQI8QBsahDuRt8MXoHQTSgqhySK+1wQhqeGUkGx+PAAlWWFWoKp2oB+OIpjtnpGrlrxc6jwr2IofYdu3Qi0KTT19AXqFwg6Qhp6l913f64N/Vf3fst/HieDHfcq+ZTPCtCdwSRNn+g79QeHSslfon7nY1ybzO0gdMFEjzQ3ibAUy7iWbbxVuLXsPjRvpX0HbUHqgoz1VNN3yYQ8XD/8Cy6JhQNyYq1QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rickandmorty GraphQL query in Altair\"\n        title=\"rickandmorty GraphQL query in Altair\"\n        src=\"/static/581e5f6799d44c248c1f7e41819b1ba7/c1b63/rickandmortyapi-graphql.png\"\n        srcset=\"/static/581e5f6799d44c248c1f7e41819b1ba7/5a46d/rickandmortyapi-graphql.png 300w,\n/static/581e5f6799d44c248c1f7e41819b1ba7/0a47e/rickandmortyapi-graphql.png 600w,\n/static/581e5f6799d44c248c1f7e41819b1ba7/c1b63/rickandmortyapi-graphql.png 1200w,\n/static/581e5f6799d44c248c1f7e41819b1ba7/d61c2/rickandmortyapi-graphql.png 1800w,\n/static/581e5f6799d44c248c1f7e41819b1ba7/97a96/rickandmortyapi-graphql.png 2400w,\n/static/581e5f6799d44c248c1f7e41819b1ba7/60708/rickandmortyapi-graphql.png 2872w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVQ4y6WS2U7DMBBF8/9/xTvQquINUTZRlSykSWzH+2XGVWiWVpVKlCs71p2TGc9kWmv0fQ8pJZRSEELAGIMYI0IMoBeV2GPzdYcyr1BWJfI8h7WWPAEhhKOXVuccMg723qcDXvmQxXs2JrOPsMbCOvbyGcjDMbQH0soPJ5dxwLUnUoC0LeouhzMKznbwTiTxPgS3BA7ZzIWUQUBPoN5KytaQqNzgEyiyRr6LwOEsGX2AcRo/cgetSsyrGr75mhbAsWlstM6iVnv0qqD7bKhcKp3L9vov5ixwDh2M3KhO19B9RVl+01rA0PfxDj27p8ABwCPEIzEHcoat3EN1n6R30kfaW3Ogn0nyevKFKZAvlTs1zOEYyJLtFnXxgEO5Iq3RVE+TihYZjueQ4ePzCbB4TNCm2ix82byjl7p3DshZ8ghdbcq8QeeB6yT/P+DrETYBmltKdqcM8/tTlsXqVqCnzluIdoe2foZoXkhb0lv62VANj9sv7HaXqW7uHaAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rickandmorty REST API request in insomnia\"\n        title=\"rickandmorty REST API request in insomnia\"\n        src=\"/static/8c73a3f57685bca35c5e18ffd689213c/c1b63/rickandmortyapi-rest.png\"\n        srcset=\"/static/8c73a3f57685bca35c5e18ffd689213c/5a46d/rickandmortyapi-rest.png 300w,\n/static/8c73a3f57685bca35c5e18ffd689213c/0a47e/rickandmortyapi-rest.png 600w,\n/static/8c73a3f57685bca35c5e18ffd689213c/c1b63/rickandmortyapi-rest.png 1200w,\n/static/8c73a3f57685bca35c5e18ffd689213c/d61c2/rickandmortyapi-rest.png 1800w,\n/static/8c73a3f57685bca35c5e18ffd689213c/4654d/rickandmortyapi-rest.png 2392w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The application uses <a href=\"https://jsonbin.io/\" target=\"_blank\" rel=\"nofollow\">JSONBin.io</a> to create and store the notes as bins for retrieval later on.</p>\n<p>As you can already tell, there are only two main views (pages) in the application: the <strong>character list</strong>, and the <strong>character details</strong> views. Other components in the app include: the <strong>Header</strong> component used across the pages, the <strong>Pagination</strong> component for the list view, and the <strong>CharacterCard</strong> component for displaying the basic info about each character in the list.</p>\n<p>For the store, there are 3 actions:</p>\n<ul>\n<li><code class=\"language-text\">getCharacters</code> fetches the characters from the API for the current page, and commits the <code class=\"language-text\">getCharactersSuccess</code> mutation with the result to the state.</li>\n<li><code class=\"language-text\">getNotes</code> fetches the list of notes from the collection on JSONBin.io, and commits the <code class=\"language-text\">getNotesSuccess</code> mutation with the retrieved notes to the state.</li>\n<li><code class=\"language-text\">addNote</code> sends a request to JSONBin.io to create a bin containing the note in a collection, and dispatches the <code class=\"language-text\">getNotes</code> action to re-fetch the characters. <em>Ideally dispatching the <code class=\"language-text\">getNotes</code> action shouldn’t be necessary at this step. You should be able to transform and commit the returned result from the request to create a bin without requiring to re-fetch all the notes, but for the purpose of this post, I have opted to dispatch the <code class=\"language-text\">getNotes</code> actions.</em></li>\n</ul>\n<p>There are also a few getters for transforming data from the state: <code class=\"language-text\">characterList</code>, <code class=\"language-text\">getCharacterById</code>, and <code class=\"language-text\">getCharacterNotes</code>.</p>\n<h2 id=\"defining-test-cases\" style=\"position:relative;\">Defining Test Cases</h2>\n<p>Irrespective of if you decide to follow the <a href=\"https://www.xkoji.dev/blog/unit-testing-javascript-applications-part-1/#what-should-i-know-about-tdd\" target=\"_blank\" rel=\"nofollow\">TDD approach</a> or not, your tests should reflect the functional requirements of your component or piece of code. If you recall how we should think about the test cases from the first post in this series:</p>\n<ul>\n<li><em>I think from a blackbox perspective when</em> determining the <em>inputs</em> and <em>outputs</em> of the piece of code to test, and I use that to create the test cases.</li>\n<li><em>I think from a whitebox perspective when</em> I need to mock dependencies, since we need knowledge about the internals of the piece of code in order to be able to mock the dependencies.</li>\n<li><em>I think from a whitebox perspective when</em> I want to cover all the logical execution flows within the piece of code, and I use this to add extra test cases, making the test suite robust.</li>\n</ul>\n<p>Let’s use another example to illustrate these points. Consider the following class:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> pow <span class=\"token keyword\">from</span> <span class=\"token string\">'super-power'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Squarer</span> <span class=\"token punctuation\">{</span>\n  lastComputed <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  #previousLastComputed <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Returns the square the specified input.\n   * If a list is provided, returns the sum of the squared of the items in list\n   */</span>\n  <span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#previousLastComputed <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastComputed<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lastComputed <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">#getSquared</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">#getSquared</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> val<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> cur</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> acc <span class=\"token operator\">+</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>cur<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> squarer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Squarer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsquarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// => 4</span>\nsquarer<span class=\"token punctuation\">.</span>lastComputed<span class=\"token punctuation\">;</span> <span class=\"token comment\">// => 2</span></code></pre></div>\n<p>This <code class=\"language-text\">Squarer</code> class has one <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Class_fields#Private_Methods\" target=\"_blank\" rel=\"nofollow\">private</a> method <code class=\"language-text\">#getSquared()</code> and one public method <code class=\"language-text\">compute()</code>. The usage is simple: you call the <code class=\"language-text\">compute(val)</code> method with a <code class=\"language-text\">val</code> parameter, and it returns the squared value. Assuming we want to test this class as a unit of code following the steps above:</p>\n<h3 id=\"create-test-cases-from-the-inputs-and-outputs-of-the-piece-of-code\" style=\"position:relative;\">Create test cases from the inputs and outputs of the piece of code</h3>\n<p>The class only accepts input via the <code class=\"language-text\">compute</code> method. However, it accepts multiple input types: an array of values, or primitive values.\nThe <em>output</em> from the class includes the result of the <code class=\"language-text\">compute()</code> method call, as well as the public <code class=\"language-text\">lastComputed</code> property.</p>\n<p>Although the class also contains <code class=\"language-text\">#previousLastComputed</code> property and <code class=\"language-text\">#getSquared()</code> method, those are private to the class and are not exposed outside the class definition. Hence, an external library or function can only interact with this class using the <code class=\"language-text\">compute()</code> method and the <code class=\"language-text\">lastComputed</code> properties. This is what we would consider as the public API/interface of the class, and that is what we consider.</p>\n<p>Given that, we can define a test case for each of the following:</p>\n<ul>\n<li>input as number</li>\n<li>input as string</li>\n<li>input as array of numbers</li>\n</ul>\n<p>It’s always a good practice to also account for edge cases when supplying inputs. For instance, you could add test cases for input as null, undefined, or an object. This could reveal possible misbehaviors within the code which you can then fix, and would lead to more consistent behavior.</p>\n<h3 id=\"determine-the-dependencies-of-the-code-that-would-need-to-be-mocked\" style=\"position:relative;\">Determine the dependencies of the code that would need to be mocked</h3>\n<p>In the class we have used a fictional module <code class=\"language-text\">super-power</code> for calculating exponents. For us to test this class in isolation <em>(unit testing)</em>, we need to mock out the <code class=\"language-text\">super-power</code> library. For this step, we just note the things that need to be mocked. Actually mocking these dependencies would require specific implementations based on the testing framework in use. We would see how we mock this in <a href=\"https://jestjs.io/\" target=\"_blank\" rel=\"nofollow\">jest</a> in a coming section.</p>\n<h3 id=\"create-extra-test-cases-covering-all-the-logical-execution-flows\" style=\"position:relative;\">Create extra test cases covering all the logical execution flows</h3>\n<p>We use <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">if</code></a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">switch</code></a> statements as well as <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Short-circuit_evaluation\" target=\"_blank\" rel=\"nofollow\">logical (short circuit evaluation)</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator\" target=\"_blank\" rel=\"nofollow\">ternary (conditional)</a> operators in JavaScript to create branches in the execution flow based on the specified conditions. These change the execution path of the code, hence could yield different results based on the applied conditions. It might not always be obvious (especially with ternary and logical operators) that there are multiple execution paths within the code. This means you could have tests for your code but still have some untested flows that could contain bugs because the tests don’t cover them.</p>\n<p>Looking at the <code class=\"language-text\">Squarer</code> class example, you would notice we have one <code class=\"language-text\">if</code> statement in the private <code class=\"language-text\">#getSquared</code> method. You would also notice that the function does something different if the condition is met, and otherwise. There is also a short circuit evaluation used on the line with the <code class=\"language-text\">return</code> statement.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> pow <span class=\"token keyword\">from</span> <span class=\"token string\">'super-power'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Squarer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">#getSquared</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> val<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> cur</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> acc <span class=\"token operator\">+</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>cur<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>If <code class=\"language-text\">pow(Number(val), 2)</code> returns a falsy value (like <code class=\"language-text\">&#39;&#39;</code>, <code class=\"language-text\">0</code>, <code class=\"language-text\">null</code>, <code class=\"language-text\">undefined</code>), we return 0 instead. As you can see, this is not immediately obvious as it is in the same line as the <code class=\"language-text\">return</code> statement.</p>\n<p>Luckily, we already covered the multiple cases in the <code class=\"language-text\">if</code> statement in the first step (input as array, input as number, etc). However we didn’t consider the short circuit with the logical OR operator. For a more robust test suite covering all cases, we should add a test case that ensures that execution path is covered as well. To do this here, we just need to ensure the returned value from the mocked <code class=\"language-text\">pow()</code> returns a falsy value, and the 0 should be returned.</p>\n<p>Having followed those 3 steps, we would have all the test cases covered, without unnecessarily testing the internal API of our class.</p>\n<h2 id=\"introducing-jest\" style=\"position:relative;\">Introducing Jest</h2>\n<p>We would be using the <a href=\"https://jestjs.io/\" target=\"_blank\" rel=\"nofollow\">Jest testing framework</a> for writing the tests for our application. Jest has gained a lot of popularity recently I believe because of its simplicity. Compared to other testing frameworks, it is very easy to get started writing tests in Jest with little or no configuration. Jest also comes with all the related tools regularly used for testing like mock functions, stubs, spies, assertions, snapshots, etc. Jest is also extendable with the ability to write your own custom runners, reporters, watch plugins, custom matchers, etc.</p>\n<p>By default, jest runs tests from files ending with <code class=\"language-text\">.spec.js</code>, <code class=\"language-text\">.test.js</code>, <code class=\"language-text\">.spec.jsx</code>, <code class=\"language-text\">.test.jsx</code>, and their typescript equivalents (<code class=\"language-text\">.spec.ts</code>, <code class=\"language-text\">.test.ts</code>, <code class=\"language-text\">.spec.tsx</code>, <code class=\"language-text\">.test.tsx</code>). Jest also runs any <code class=\"language-text\">.js</code>, <code class=\"language-text\">.jsx</code>, <code class=\"language-text\">.ts</code>, <code class=\"language-text\">.tsx</code> files in any <code class=\"language-text\">__tests__</code> directory. There are usually two patterns used to organize your test files: either storing the test files together in a <code class=\"language-text\">__tests__</code> directory next to the source directory, or storing them right next to the source files.</p>\n<p>Let’s write the test cases we have defined for the <code class=\"language-text\">Squarer</code> class.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// squarer.spec.js</span>\n\n<span class=\"token keyword\">import</span> pow <span class=\"token keyword\">from</span> <span class=\"token string\">'super-power'</span><span class=\"token punctuation\">;</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'super-power'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">**</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Squarer'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.compute()'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should square the number input'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> squarer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Squarer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should square the parsed number in the string input'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> squarer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Squarer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'10'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should return the sum of the square of the numbers in the array input'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> squarer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Squarer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">105</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should return zero for invalid inputs'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> squarer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Squarer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>squarer<span class=\"token punctuation\">.</span><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Within each test file, the test cases are organized into test suites. Test suites are used for grouping test cases related to the same piece of code. In Jest, test suites are defined using the <a href=\"https://jestjs.io/docs/en/api#describename-fn\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">describe()</code></a> method while test cases are defined using the <a href=\"https://jestjs.io/docs/en/api#testname-fn-timeout\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">test()</code> or <code class=\"language-text\">it()</code></a> methods. <em>You can learn more about all the globals available in Jest tests <a href=\"https://jestjs.io/docs/en/api\" target=\"_blank\" rel=\"nofollow\">here</a>.</em></p>\n<p>The tests above cover all the test cases we previously defined, including the edge cases like <code class=\"language-text\">null</code> and <code class=\"language-text\">undefined</code>. It also covers the short circuit to return zero, by providing an input that would cause the <code class=\"language-text\">pow</code> mock to return zero (the square of zero is zero). Jest allows us to mock the <code class=\"language-text\">pow</code> module using the <code class=\"language-text\">jest.mock()</code> method at the top of the file. Here, we define the module to return a function that returns the exponentiation result of the base (first parameter) and the exponent (second parameter).</p>\n<h2 id=\"testing-the-store\" style=\"position:relative;\">Testing the Store</h2>\n<p>Now coming back to our application. Let’s write the unit tests for the store (actions, mutations and getters). We would write tests for just one function in each category, as the learnings can be applied to the others.</p>\n<h3 id=\"action-getcharacters\" style=\"position:relative;\">Action: getCharacters</h3>\n<p>Let’s look at the <strong>functional requirements</strong> for the <code class=\"language-text\">getCharacters</code> action:</p>\n<ul>\n<li>it can be called without parameters, or with an object containing the page number to fetch.</li>\n<li>it should fetch characters data from the rickandmorty API using the <code class=\"language-text\">rickmorty</code> module for the specified page.</li>\n<li>it should commit the fetched data to the <code class=\"language-text\">getCharactersSuccess</code> mutation.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getCharacter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/api/rickmorty'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> actions <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">async</span> <span class=\"token function\">getCharacters</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> commit <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCharacter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getCharactersSuccess'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> res<span class=\"token punctuation\">,</span> page<span class=\"token operator\">:</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span>  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> actions<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now looking at the <strong>inputs and outputs</strong> (public interface) of the action:</p>\n<ul>\n<li>first parameter is passed by Vuex, so is a constant which we don’t control.</li>\n<li>we provide the second parameter to the <code class=\"language-text\">getCharacters</code> action, an object containing <code class=\"language-text\">page</code>.</li>\n<li>we can omit the second parameter and the default should be used instead.</li>\n<li>actions don’t return values, or their returned values aren’t used. Instead, they are expected to perform tasks like asynchronously fetching data from a server, saving a file to the disk, committing some mutation, etc. In that sense, the expected result (<em>output</em>) of an action is not the value it returns, but the actions it performs. This is usually the case for impure functions. Since they could have intended side effects, you want to make sure that the intended side effect happens as expected, which is the result/output of the function. For the case of the <code class=\"language-text\">getCharacters</code> action, you expect that the <code class=\"language-text\">getCharacters</code> rickandmorty API is called to get the characters data, and you expect that the <code class=\"language-text\">commit()</code> is called with the <code class=\"language-text\">getCharactersSuccess</code> mutation and the characters data and page.</li>\n</ul>\n<p><em>Note: Ideally the main side effect to be considered should be just the committing of the mutation, but we generally also test that the <code class=\"language-text\">getCharacters</code> method is called from the <code class=\"language-text\">rickmorty</code> module.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> actions <span class=\"token keyword\">from</span> <span class=\"token string\">'./actions'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> rickmorty <span class=\"token keyword\">from</span> <span class=\"token string\">'@/api/rickmorty'</span><span class=\"token punctuation\">;</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@/api/rickmorty'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getCharacters'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    jest<span class=\"token punctuation\">.</span><span class=\"token function\">clearAllMocks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should commit the default page and data from the api'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> commit <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> x<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">(</span>rickmorty<span class=\"token punctuation\">.</span>getCharacter <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> <span class=\"token punctuation\">(</span>actions <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCharacters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> commit <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>rickmorty<span class=\"token punctuation\">.</span>getCharacter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>commit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'getCharactersSuccess'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> page<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should commit the specified page and data from the API'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> commit <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> x<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">(</span>rickmorty<span class=\"token punctuation\">.</span>getCharacter <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> <span class=\"token punctuation\">(</span>actions <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCharacters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> commit <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token operator\">:</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>rickmorty<span class=\"token punctuation\">.</span>getCharacter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token operator\">:</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>commit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'getCharactersSuccess'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> page<span class=\"token operator\">:</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We have written two test cases for the <code class=\"language-text\">getCharacters</code> action. In both test cases, we mocked the <code class=\"language-text\">rickmorty.getCharacter()</code> method to return some data, and we check that the method was called using <code class=\"language-text\">expect().toHaveBeenCalled()</code>. We also check that the <code class=\"language-text\">commit()</code> method was called with the <code class=\"language-text\">getCharactersSuccess</code> mutation and the data containing the response from the API and the page number. In the first case we don’t pass in the page number as a parameter to the action, but we expect the default page number to be used and committed.</p>\n<p>One thing to note here is that you can only use the <code class=\"language-text\">.toHaveBeenCalled()</code>/<code class=\"language-text\">.toHaveBeenCalledWith()</code> assertions for jest mock functions (<code class=\"language-text\">jest.fn()</code>). In the test cases above, we can see that <code class=\"language-text\">commit</code> is a jest mock function. We also mocked the <code class=\"language-text\">rickmorty</code> module using the <code class=\"language-text\">jest.mock(&#39;@/api/rickmorty&#39;)</code> statement at the top. This is jest’s “automatic mock” ability. With that, every method or property from the <code class=\"language-text\">rickmorty</code> module is now a jest mock, and not the original implementation. So you can implement the mock to return specific outputs within a test case using the <a href=\"https://jestjs.io/docs/en/mock-function-api#mockfnmockimplementationfn\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">.mockImplementation()</code></a> factory method.\nWe mocked the <code class=\"language-text\">rickmorty.getCharacter()</code> method to resolve with <code class=\"language-text\">data</code> in the test cases above, so anytime that method is executed within thw action, it would return a promise that resolves with <code class=\"language-text\">data</code>.</p>\n<p>We also added a <code class=\"language-text\">beforeEach()</code> method within the test suite that calls <code class=\"language-text\">jest.clearAllMocks()</code>. This is already self-explanatory. Basically before each test case is run, the <code class=\"language-text\">beforeEach()</code> method is executed, and it clears all the mocks and their implementations (like those done using <code class=\"language-text\">mockImplementation</code>), ensuring that the mocks don’t have any stale data. This ensures the tests don’t get influenced by mocks from previous test cases.</p>\n<blockquote>\n<p>You can find out other ways to mock modules <a href=\"https://jestjs.io/docs/en/es6-class-mocks\" target=\"_blank\" rel=\"nofollow\">here</a>.</p>\n</blockquote>\n<p>The same approach for testing this action can be applied to all the other actions as well. If an action simply dispatches another action, then check that the <code class=\"language-text\">dispatch</code> is called with the right parameters. If it calls some other API to fetch or store data, or perform some other task, then check that the API was called from within the action. Remember the API should be mocked in the test since its implementation is not part of the action being tested.</p>\n<p><em>Side Note: You might be wondering why we have things like <code class=\"language-text\">(actions as any)</code> in the tests. This is so that typescript doesn’t throw errors. The type of <code class=\"language-text\">actions</code> should be <code class=\"language-text\">ActionTree</code> since it is the actions object, and you can’t directly call the functions in the actions (you would normally dispatch actions from your Vue components and Vue would handle calling the actions), so typescript doesn’t allow us use the action this way in the test, so we cast the <code class=\"language-text\">actions</code> to <code class=\"language-text\">any</code> to remove all the type checking. Similarly, <code class=\"language-text\">(rickmorty.getCharacter as any)</code> is used since the module is mocked and now has the <code class=\"language-text\">.mockImplementation()</code> method, but typescript doesn’t know that either, so we disable type checking there as well.</em></p>\n<h3 id=\"mutation-getcharacterssuccess\" style=\"position:relative;\">Mutation: getCharactersSuccess</h3>\n<p>Vuex mutations have only one job - to modify the state. Your mutations should be as simple as possible, and shouldn’t manage a lot of business logic. If you need to perform a lot of business logic before modifying the state, then you should consider performing those operations within an action, and only call the mutation when the state needs to be modified.</p>\n<p>Let’s define the requirements for the <code class=\"language-text\">getCharactersSuccess</code> mutation:</p>\n<ul>\n<li>it should be called with an object containing <code class=\"language-text\">data</code> and <code class=\"language-text\">page</code>.</li>\n<li>it should store a list of character IDs.</li>\n<li>it should store a map/lookup table of the characters by their IDs for easy retrieval of single characters.</li>\n<li>it should store the <code class=\"language-text\">info</code> returned from the API.</li>\n<li>it should store the <code class=\"language-text\">page</code> in the <code class=\"language-text\">info</code> object.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> Vue <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MutationTree <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vuex'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> State<span class=\"token punctuation\">,</span> CharacterDataModel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./state'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> mutations<span class=\"token operator\">:</span> MutationTree<span class=\"token operator\">&lt;</span>State<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">getCharactersSuccess</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> list<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    data<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token operator\">:</span> CharacterDataModel</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      list<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      Vue<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>map<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>list <span class=\"token operator\">=</span> list<span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>info <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>data<span class=\"token punctuation\">.</span>info <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">.</span>page <span class=\"token operator\">=</span> page<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> mutations<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Looking at the public interface of this mutation, the <em>input</em> is an object containing <code class=\"language-text\">page</code> and <code class=\"language-text\">data</code>. The <em>output</em> (expected result of executing this mutation) is that the <code class=\"language-text\">state</code> object is modified to contain the data as specified in the requirements. Similarly to the actions, the first input parameter to the mutation (<code class=\"language-text\">state</code>) is provided by Vue, and is not something the user of the mutation can control.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getCharactersSuccess'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should set the correct state values'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      characters<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        info<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        list<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        map<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> payload <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      info<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> reqDetails<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      results<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n          name<span class=\"token operator\">:</span> <span class=\"token string\">'First'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n          name<span class=\"token operator\">:</span> <span class=\"token string\">'Second'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">(</span>mutations <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCharactersSuccess</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> payload<span class=\"token punctuation\">,</span> page<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token number\">1</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">:</span> <span class=\"token string\">'First'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">2</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token operator\">:</span> <span class=\"token string\">'Second'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> reqDetails<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> page<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There isn’t much variation in this mutation. It only accepts one type of data, and always modifies the state in the same way. No conditionals, no short circuiting, no default values. Therefore we only need one test case to cover this mutation.</p>\n<p>We call the mutation with a <code class=\"language-text\">state</code> object and an object containing <code class=\"language-text\">data</code> and <code class=\"language-text\">page</code>.\nThen we check that the state contains a list of character IDs.\nWe check that the state contains a mapping of character IDs to characters.\nWe check that the state contains the <code class=\"language-text\">info</code> object as well as the <code class=\"language-text\">page</code> property.</p>\n<p>One thing to note is the use of <a href=\"https://jestjs.io/docs/en/expect#toequalvalue\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">.toEqual()</code></a> instead of the more common <a href=\"https://jestjs.io/docs/en/expect#tobevalue\" target=\"_blank\" rel=\"nofollow\"><code class=\"language-text\">.toBe()</code></a> assertion. The reason for this is that we want to compare the values based on their value, and not by reference. The <code class=\"language-text\">.toBe()</code> would use the strict comparison <code class=\"language-text\">===</code> to compare the two values, which means two objects containing the same sets of data <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Identity\" target=\"_blank\" rel=\"nofollow\">would not be equal</a> since they have different references. <code class=\"language-text\">.toEqual()</code> recursively compares all the properties of the values instead of just checking their referential identity.</p>\n<blockquote>\n<p>Should we mock <code class=\"language-text\">Vue.set</code>? If we want to be as strict as possible, then I believe you should mock it. However, in this context, <code class=\"language-text\">Vue.set</code> simply assigns a value to an object property, like doing <code class=\"language-text\">object.a = 1;</code>. For me, its presence in the code is as normal as native JavaScript methods and as such, I don’t really consider it as something that needs to be mocked, but that might just be a bias on my part. Either way, mocking it is rather easy:</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">jest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vue'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> prop<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      target<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"getter-characterlist\" style=\"position:relative;\">Getter: characterList</h3>\n<p>Vuex getters return a slice of the state, or data derived from the state. Getters are similar to the computed properties in Vue components in that they are cached and reactive, so they only get computed whenever the input changes, in this case the input is the state. They can either return a value or return a function.</p>\n<p>We would be looking at the <code class=\"language-text\">characterList</code> getter which returns a list of character data based on the list of character IDs and the mapping of character ID to character data we already have in the state, from the <code class=\"language-text\">getCharactersSuccess</code> mutation above.</p>\n<p>The requirements of the <code class=\"language-text\">characterList</code> getter are very simple:</p>\n<ul>\n<li>it takes the state as the only argument which is provided by Vue and the user wouldn’t have control over it. So using it in the vue context, the user would provide no parameter.</li>\n<li>it returns an array of character data based on the list of character IDs and character data mappings.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> GetterTree <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vuex'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> State <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./state'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> getters<span class=\"token operator\">:</span> GetterTree<span class=\"token operator\">&lt;</span>State<span class=\"token punctuation\">,</span> State<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">characterList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>characters<span class=\"token punctuation\">.</span>map<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> getters<span class=\"token punctuation\">;</span></code></pre></div>\n<p>The getters are generally pure functions, so we know that the output is only dependent on the input, and there is no side effect either. Looking at the public interface of the <code class=\"language-text\">characterList</code> getter, it accepts one input (<code class=\"language-text\">state</code>) and always returns an array of zero or more character data.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  characters<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    list<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    map<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token number\">1</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        x<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">2</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        y<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'characterList'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should return list of character data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>getters <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">characterList</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        x<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        y<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>One test case is sufficient for this getter. We pass a <code class=\"language-text\">state</code> object as a parameter to <code class=\"language-text\">characterList</code>, and we assert that the returned value of the getter is an array of character data matching the data in the state.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\">Conclusion</h2>\n<p>In this post, we illustrated the approaches of unit testing using more examples. We also introduced the application we would be using as a case study in this series and looked at how we can write tests for the various parts of the store.\nFrom the tests we have written so far, we see how following the testing approach and considering the public interface (inputs and outputs) of the piece of code helps us to define the test cases without unnecessarily testing internal implementations that make the tests harder to maintain.</p>\n<p>As a reminder, you should get your tests to fail at least once to ensure you aren’t getting false positives and that your tests are functioning properly.</p>\n<p>In the next post, we would dive into writing unit tests for Vue components and see how we can make use of the vue test utils to make the testing process of vue components easier.</p>\n<p>For reference, the source code of the application we are working with is located here: <a href=\"https://github.com/imolorhe/rick-morty\" target=\"_blank\" rel=\"nofollow\">https://github.com/imolorhe/rick-morty</a></p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#the-application\">The Application</a></p>\n<ul>\n<li><a href=\"#what-is-the-application-built-with\">What is the application built with?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#defining-test-cases\">Defining Test Cases</a></p>\n<ul>\n<li><a href=\"#create-test-cases-from-the-inputs-and-outputs-of-the-piece-of-code\">Create test cases from the inputs and outputs of the piece of code</a></li>\n<li><a href=\"#determine-the-dependencies-of-the-code-that-would-need-to-be-mocked\">Determine the dependencies of the code that would need to be mocked</a></li>\n<li><a href=\"#create-extra-test-cases-covering-all-the-logical-execution-flows\">Create extra test cases covering all the logical execution flows</a></li>\n</ul>\n</li>\n<li><a href=\"#introducing-jest\">Introducing Jest</a></li>\n<li>\n<p><a href=\"#testing-the-store\">Testing the Store</a></p>\n<ul>\n<li><a href=\"#action-getcharacters\">Action: getCharacters</a></li>\n<li><a href=\"#mutation-getcharacterssuccess\">Mutation: getCharactersSuccess</a></li>\n<li><a href=\"#getter-characterlist\">Getter: characterList</a></li>\n</ul>\n</li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>","frontmatter":{"title":"Unit testing JavaScript Applications - Part 2","date":"May 22, 2020","description":"","image":null}}},"pageContext":{"slug":"/blog/unit-testing-javascript-applications---part-2/","previous":{"fields":{"slug":"/blog/unit-testing-javascript-applications-part-1/"},"frontmatter":{"title":"Unit testing JavaScript Applications - Part 1","draft":null}},"next":{"fields":{"slug":"/blog/unit-testing-javascript-applications---part-3/"},"frontmatter":{"title":"Unit testing JavaScript Applications - Part 3 (Vue components)","draft":false}}}}}